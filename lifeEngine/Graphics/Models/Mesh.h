//////////////////////////////////////////////////////////////////////////
// 
//			*** lifeEngine (Двигатель Жизни) ***
//					Copyright (C) 2017
//
// Связь со мной:		https://vk.com/zombihello
// Репозиторий движка:  https://github.com/zombihello/lifeEngine
// 
//////////////////////////////////////////////////////////////////////////

#ifndef MESH_H
#define MESH_H

#define COMPILING_LIBRARY
#include <DllGlobal.h>

///////////////////////////
// СИСТЕМНЫЕ БИБЛИОТЕКИ
///////////////////////////
#include <string>
#include <vector>
#include <map>
using namespace std;

//////////////
// OPENGL
//////////////
#include <glm\glm.hpp>

//////////
// XML
//////////
#include <tinyxml.h>

//////////////////
// SFML
//////////////////
#include <SFML\OpenGL.hpp>
using namespace sf;

//////////////////
// LIFEENGINE
//////////////////
#include <Graphics\Models\AnimationManager.h>
#include <Graphics\Bounding Volume\BoundingBox.h>
#include <Graphics\Models\Skeleton.h>
#include <Graphics\Models\MeshVertex.h>
#include <System\Logger.h>

namespace le
{
	//////////////////////////////////////////////////////////////////////
	/// \brief Класс для загрузки мешей
	///
	/// Данный класс предназначен для загрузки сетки модели и ее хранение
	//////////////////////////////////////////////////////////////////////
	class DLL_API Mesh
	{
	public:
		//////////////////////////////////////////////////////////////////////
		/// \brief Загрузить модель
		///
		/// \param[in] Route Путь к файлу
		/// \return true если все прошло успешно, иначе false
		//////////////////////////////////////////////////////////////////////
		bool LoadMesh( const string& Route );

		//////////////////////////////////////////////////////////////////////
		/// \brief Очистить меш
		/// \details Метод удаляет загруженный меш из памяти
		//////////////////////////////////////////////////////////////////////
		void ClearMesh();

		//////////////////////////////////////////////////////////////////////
		/// \brief Получить массив вершин для VBO	
		///
		/// \return const vector<MeshVertex>&
		//////////////////////////////////////////////////////////////////////
		const vector<MeshVertex>& GetVBO_Vertexs();

		//////////////////////////////////////////////////////////////////////
		/// \brief Получить массив текстур
		///
		/// \return const vector<GLuint>&
		//////////////////////////////////////////////////////////////////////
		const vector<GLuint>& GetTextures();

		//////////////////////////////////////////////////////////////////////
		/// \brief Получить массив id вершин без повторений
		///
		/// \return const map<int, vector<int>>&
		//////////////////////////////////////////////////////////////////////
		const map<int, vector<int>>& GetVertexs();

		//////////////////////////////////////////////////////////////////////
		/// \brief Получить ID вершин, порядок соединения
		///
		/// \return const map<GLuint, vector<unsigned int>>&
		//////////////////////////////////////////////////////////////////////
		const map<GLuint, vector<unsigned int>>& GetIdVertexs();

		//////////////////////////////////////////////////////////////////////
		/// \brief Получить скелет меша
		///
		/// \return const Skeleton&
		//////////////////////////////////////////////////////////////////////
		const Skeleton& GetSkeleton();

		//////////////////////////////////////////////////////////////////////
		/// \brief Получить анимации меша
		///
		/// \return const AnimationManager&
		//////////////////////////////////////////////////////////////////////
		const AnimationManager& GetAnimations();

		//////////////////////////////////////////////////////////////////////
		/// \brief Получить ограничивающее тело меша
		///
		/// \return const BoundingBox&
		//////////////////////////////////////////////////////////////////////
		const BoundingBox& GetBoundingBox();

		//////////////////////////////////////////////////////////////////////
		/// \brief Нет ли скелета
		///
		/// \return bool
		//////////////////////////////////////////////////////////////////////
		bool IsNoSkeleton();

	private:

		bool									NoSkeleton; ///< Нет ли скелета
		Skeleton								Skeleton; ///< Скелет модели
		AnimationManager						AnimationManager; ///< Менеджер анимаций
		BoundingBox								BoundingBox; ///< Ограничивающее тело меша
		vector<MeshVertex>						VBO_Vertexs; ///< Массив вершин для VBO	
		vector<GLuint>							Textures; ///< Массив текстур
		map<GLuint, vector<unsigned int>>		IdVertexs; ///< ID Вершин, порядок соединения
		map<int, vector<int>>					Vertexs; ///< Массив id вершин без повторений
	};

	//-------------------------------------------------------------------------//
}

#endif // MESH_H

